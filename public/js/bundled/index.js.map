{"mappings":"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","sources":["public/js/mapbox.js","public/js/alerts.js","public/js/updateSettings.js","public/js/index.js","public/js/login.js","public/js/stripe.js"],"sourcesContent":["\r\n\r\nexport const displayMap = (locations) => {\r\n    mapboxgl.accessToken = 'pk.eyJ1IjoicHN5Y2hlc3MiLCJhIjoiY2tzaDUzdmJpMXFxeDJub2R0a3M1Mnd6biJ9.gTUOrFnxxRXJ9NLslEyIqg';\r\n\r\n    var map = new mapboxgl.Map({\r\n    container: 'map',\r\n    style: 'mapbox://styles/psychess/ckshek1554i4517nuz1i07omb',\r\n    scrollZoom: false\r\n    // center: [-118.113491, 34.111745],\r\n    // zoom: 10,\r\n    // interactive: false\r\n    });\r\n    \r\n    const bounds = new mapboxgl.LngLatBounds();\r\n    \r\n    \r\n    locations.forEach(loc => {\r\n        //Create marker\r\n        const el = document.createElement('div');\r\n        el.className = 'marker'\r\n        //Add marker\r\n        new mapboxgl.Marker({\r\n            element: el,\r\n            anchor: 'bottom'\r\n        }).setLngLat(loc.coordinates).addTo(map);\r\n        //Add popup\r\n    \r\n    \r\n        new mapboxgl.Popup({ offset: 30}).setLngLat(loc.coordinates).setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`).addTo(map);\r\n        //Extends map bounds to include current location\r\n        bounds.extend(loc.coordinates)\r\n    })\r\n    \r\n    \r\n    map.fitBounds(bounds, {\r\n        padding: {\r\n            top: 200,\r\n            bottom: 150,\r\n            left: 100,\r\n            right: 100\r\n        }\r\n    });\r\n}\r\n\r\n","//type is success or error\r\nexport const showAlert = (type, msg) => {\r\n    hideAlert();\r\n    const markup = `<div class=\"alert alert--${type}\">${msg}</div> `;\r\n    document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\r\n    window.setTimeout(hideAlert, 5000)\r\n    \r\n}\r\n\r\nexport const hideAlert = () => {\r\n    const el = document.querySelector('.alert');\r\n    if (el) el.parentElement.removeChild(el);\r\n}","import axios from 'axios';\r\nimport {showAlert} from './alerts';\r\n//И для смены пароля, и для смены другой информации пользователя. type - или 'password' или 'data'\r\nexport const updateSettings = async (data, type) => {\r\n    try {\r\n        const url =\r\n          type === 'password'\r\n            ? '/api/v1/users/updateMyPassword'\r\n            : '/api/v1/users/updateMe';\r\n        const result = await axios({\r\n            method: 'PATCH',\r\n            url: url,\r\n            data: data\r\n        })\r\n        const msg = type === 'password' ? 'Пароль успешно обновлён' : 'Данные успешно обновлены!';\r\n        if (result.data.status === 'success') {\r\n            showAlert('success', msg)\r\n        }\r\n    } catch (err) {\r\n        showAlert('error', err.response.data.message)\r\n    }\r\n}","import '@babel/polyfill';\r\nimport { displayMap } from './mapbox';\r\nimport {login, logout} from './login';\r\nimport {updateSettings} from './updateSettings';\r\nimport { bookTour } from './stripe';\r\n\r\n//DOM elements\r\nconst mapBox = document.getElementById('map');\r\nconst loginForm = document.querySelector('.form--login');\r\nconst logoutButton = document.querySelector('.nav__el--logout');\r\nconst userDataForm = document.querySelector('.form-user-data');\r\nconst userPasswordForm = document.querySelector('.form-user-password');\r\nconst bookButton = document.getElementById('book-tour');\r\n\r\n//VALUES\r\n\r\n\r\n//DELEGATION\r\nif(mapBox) {\r\n    const locations = JSON.parse(mapBox.dataset.locations);\r\n    \r\n    displayMap(locations);\r\n}\r\n\r\nif(loginForm){\r\n    \r\ndocument.querySelector('.form').addEventListener('submit', e => {\r\n    e.preventDefault();\r\n    const email = document.getElementById('email').value;\r\nconst password = document.getElementById('password').value;\r\n    \r\n    login(email, password);\r\n})\r\n}\r\n\r\nif(logoutButton) {\r\n    logoutButton.addEventListener('click', logout);\r\n}\r\n\r\n\r\nif (userDataForm) {\r\n    userDataForm.addEventListener('submit', e => {\r\n        e.preventDefault();\r\n        const form = new FormData();\r\n        form.append('name', document.getElementById('name').value);\r\n        form.append('email', document.getElementById('email').value);\r\n        form.append('photo', document.getElementById('photo').files[0]);\r\n        \r\n    \r\n        updateSettings(form, 'data');\r\n    })\r\n}\r\n\r\nif (userPasswordForm) {\r\n    userPasswordForm.addEventListener('submit', async e => {\r\n        e.preventDefault();\r\n        document.querySelector('.btn--save-password').textContent = 'Updating...';\r\n        const passwordCurrent = document.getElementById('password-current').value;\r\n        const password = document.getElementById('password').value;\r\n        const passwordConfirm = document.getElementById('password-confirm').value;\r\n       \r\n        await updateSettings({passwordCurrent, password, passwordConfirm}, 'password');\r\n        document.querySelector('.btn--save-password').textContent = 'Save password';\r\n        document.getElementById('password-current').value='';\r\n        document.getElementById('password').value='';\r\n        document.getElementById('password-confirm').value='';\r\n    })\r\n}\r\n\r\nif (bookButton) {\r\n    bookButton.addEventListener('click', e => {\r\n        e.target.textContent = 'Processing...'\r\n        // У нас в шаблоне tour-id, но джаваскрипт преобразует автоматом это в tourId\r\n        const tourId = e.target.dataset.tourId;\r\n        bookTour(tourId);\r\n    })\r\n}","import axios from 'axios';\r\nimport { showAlert } from './alerts';\r\nexport const login = async (email, password) => {\r\n    \r\n    try {\r\n        const result = await axios({\r\n            method: 'POST',\r\n            url: '/api/v1/users/login',\r\n            data: {\r\n                email: email,\r\n                password: password\r\n            }\r\n        });\r\n        if (result.data.status === 'success'){\r\n            showAlert('success', 'Logged in successfuly!');\r\n            window.setTimeout(() => {\r\n                location.assign('/');\r\n            }, 1500)\r\n        }\r\n         \r\n    } catch (err) {\r\n        showAlert('error', err.response.data.message)\r\n    }\r\n    \r\n};\r\n\r\nexport const logout = async () => {\r\n    try {\r\n        const res = await axios({\r\n            method: 'GET', \r\n            url: '/api/v1/users/logout'\r\n        });\r\n        if(res.data.status === 'success') location.reload();\r\n        \r\n    } catch (err) {\r\n        showAlert('error', 'Ошибка при выходе из аккаунта! Попробуйте снова')\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// document.querySelector('.form').addEventListener('submit', e => {\r\n//     e.preventDefault();\r\n//     const email = document.getElementById('email').value;\r\n//     const password = document.getElementById('password').value;\r\n//     login(email, password);\r\n// })","import axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\n\r\nexport const bookTour = async tourId => {\r\n    const stripe = Stripe('pk_test_51JT61tGVu2nLM0L5XDaj0Kno07DQpTRGfCBFxnhdAQTRhbtnvuPrf8hrx7uHPwIfNCN8VC5Cnlu7Xs3rUWjy8scO00ZFP0UNMN');\r\n    try {\r\n\r\n        //1) Получить сессию с бэкэнда\r\n        const session = await axios(`/api/v1/bookings/checkout-session/${tourId}`)\r\n        // console.log(session);\r\n        //2) Создать checkout form + списать деньги с карты\r\n        await stripe.redirectToCheckout({\r\n            sessionId: session.data.session.id\r\n        });\r\n\r\n    } catch (err) {\r\n        console.log(err);\r\n        showAlert('error', err);\r\n    }\r\n}"],"names":["$b01db4da9d111652$export$e2ed28791945543d","type","msg","$b01db4da9d111652$export$5a81baf3e1f8b5bb","markup","document","querySelector","insertAdjacentHTML","window","setTimeout","el","parentElement","removeChild","$baec1ded6f001e5d$export$81acc09c7bdb4525","async","data","url","result","$parcel$interopDefault","$ct7a6$axios","method","status","err","response","message","$e90d12d35cb48c24$var$mapBox","getElementById","$e90d12d35cb48c24$var$loginForm","$e90d12d35cb48c24$var$logoutButton","$e90d12d35cb48c24$var$userDataForm","$e90d12d35cb48c24$var$userPasswordForm","$e90d12d35cb48c24$var$bookButton","locations","mapboxgl","accessToken","map","Map","container","style","scrollZoom","bounds","LngLatBounds","forEach","loc","createElement","className","Marker","element","anchor","setLngLat","coordinates","addTo","Popup","offset","setHTML","day","description","extend","fitBounds","padding","top","bottom","left","right","$1c25fba746cc31ee$export$976c4dce80bbf3f7","JSON","parse","dataset","addEventListener","e","preventDefault","email","password","location","assign","$212ec473d5bf09c9$export$4a142f624dd0fa8","value","reload","form","FormData","append","files","textContent","passwordCurrent","passwordConfirm","target","tourId","stripe","Stripe","session","redirectToCheckout","sessionId","id","console","log","$5b30c8a71ad7f90c$export$54ca10ceadf03905"],"version":3,"file":"index.js.map","sourceRoot":"../../../"}